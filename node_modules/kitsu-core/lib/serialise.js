"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./error.js");function r(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function e(t,r,e,n){const o=new Error("".concat(n," requires an ID for the ").concat(r," type"));if(void 0===r)throw new Error("".concat(n," requires a resource type"));if(t){if("POST"!==n&&e.length>0)for(const t of e)if(!t.id)throw o}else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error("".concat(n," requires an object or array body"));if("POST"!==n&&!e.id)throw o}}function n(t,r,e){r[e]={data:{}};for(const n of Object.keys(t[e].data)){const o=t[e].data[n];let a=r[e].data;n&&!["id","type"].includes(n)?a=l(o,n,a):a[n]=o}return r}function o(t,r,e){r[e]={data:[]};for(const n of t[e].data)r[e].data.push(n);return r}function a(t){let r={};for(const e in t){r=Array.isArray(t[e].data)?o(t,r,e):n(t,r,e)}return r}function i(t,r,e,n){return n.relationships||(n.relationships={}),t.type||(t.type=r),n.relationships[e]={data:Object.assign(t)},n.relationships=a(n.relationships),n}function s(t,e,n,o){return o.relationships||(o.relationships={}),o.relationships[n]={data:t.map(t=>{let{id:n,type:o}=t,a=r(t,["id","type"]);return{id:n,type:o||e,attributes:Object.keys(a).length?a:void 0}})},o.relationships=a(o.relationships),o}function l(t,r,e){return e.attributes||(e.attributes={}),e.attributes[r]=t,e}function c(t){return Object.prototype.hasOwnProperty.call(t,"id")}function u(t,r,n,o){e(!1,t,r,n);let a={type:t=o.pluralTypes(o.camelCaseTypes(t))};(null==r?void 0:r.id)&&(a.id=String(r.id));for(const t in r){const e=r[t],n=o.pluralTypes(o.camelCaseTypes(t));null!==e&&(null==e?void 0:e.constructor)===Object&&c(e)?a=i(e,n,t,a):null!==e&&Array.isArray(e)&&e.length>0&&c(e[0])?a=s(e,n,t,a):"id"!==t&&"type"!==t&&(a=l(e,t,a))}return{data:a}}exports.serialise=function(r,n={},o="POST",a={}){try{return a.camelCaseTypes||(a.camelCaseTypes=t=>t),a.pluralTypes||(a.pluralTypes=t=>t),null===n||Array.isArray(n)&&0===n.length?{data:n}:Array.isArray(n)&&(null==n?void 0:n.length)>0?function(t,r,n,o){e(!0,t,r,n);const a=[];for(const e of r)a.push(u(t,e,n,o).data);return{data:a}}(r,n,o,a):u(r,n,o,a)}catch(r){throw t.error(r)}};
